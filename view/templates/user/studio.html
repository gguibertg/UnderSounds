<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8"> <!-- Codificaci√≥n de caracteres -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Escalabilidad de la p√°gina -->
    <meta name="author" content="L1-G4">
    <title>Studio</title> <!-- T√≠tulo que aparece en la pesta√±a del navegador -->
    <!-- Estilos -->
    <link rel="stylesheet" href="/static/css/base/style.css"> <!-- Hoja de estilos principal -->
    <link rel="stylesheet" href="/static/css/base/darkmode.css"> <!-- Hoja de estilo de modo oscuro -->
    <link rel="stylesheet" href="/static/css/base/header.css"> <!-- Hoja de estilo del header -->
    <link rel="stylesheet" href="/static/css/base/footer.css"> <!-- Hoja de estilo del footer -->
    <link rel="stylesheet" href="/static/css/user/studio.css"> <!-- Hoja de estilos de la p√°gina studio -->
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/icons/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/static/icons/favicons/favicon.svg" />
    <link rel="shortcut icon" href="/static/icons/favicons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/favicons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="UnderSounds" />
    <link rel="manifest" href="/static/icons/favicons/site.webmanifest" />
</head>

<body>

    <!-- Barra de navegaci√≥n -->
    <div id="header-placeholder"></div>

    <!-- Contenido principal -->
    <main>
        <div class="div-bg">
            <br>
            
            <div class="div-pannel" style="width: 80%; align-items: center;">
                <p class="songs-title">Tus √Ålbumes</p>
                <div class="parent">

                    {% for album in albums %}
                    <div class="div-pannel-sub songs-cell">
                        <img src="{{ album.portada }}" class="songs-image" alt="Album Image">
                        <b style="font-size: 1.3rem;">{{ album.titulo }}</b>
                        <p>Autor: {{ album.autor }}</p>

                        <div class="song-info">
                            <div style="text-align: center;">
                                <img src="/static/icons/site/favourite-icon-light.svg" class="song-love" alt="Fav">
                                <div>{{ album.likes }}</div>
                            </div>
                            <div style="text-align: center;">
                                <img src="/static/icons/site/views-icon-light.svg" class="song-view" alt="Views">
                                <div>{{ album.visitas }}</div>
                            </div>
                            <div style="text-align: center;">
                                <img src="/static/icons/site/visibility-icon-light.svg" class="song-visible" alt="Visible">
                                <div>{{ "Visible" if album.visible else "Oculto" }}</div>
                            </div>
                        </div>

                        <div class="button-array">
                            <button type="button" style="background-color: white;" onclick="window.location.href='/album?id={{ album.id }}'">üîó</button>
                            <button type="button" style="background-color: #ff4646;" onclick="removeAlbum('{{ album.id }}')">üóëÔ∏è</button>
                            <button type="button" style="background-color: #0077ff;" onclick="window.location.href='/album-edit?id={{ album.id }}'">‚úèÔ∏è</button>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="div-pannel-sub songs-cell">
                        <button class="add-btn" onclick="window.location.href='/upload-album'">‚ûï A√±adir √°lbum</button>
                    </div>
                </div>
                <br>
            </div>

            <br>
            <br>

            <div class="div-pannel" style="width: 80%; align-items: center;">
                <p class="songs-title">Tus Canciones</p>
                <div class="parent">
                    {% for song in songs %}
                    <div class="div-pannel-sub songs-cell">
                        <img src="{{ song.portada }}" class="songs-image" alt="Song Image">
                        <b style="font-size: 1.3rem;">{{ song.titulo }}</b>
                        <p>√Ålbum: {{ song.album }}</p>

                        <div class="song-info">
                            <div style="text-align: center;">
                                <img src="/static/icons/site/favourite-icon-light.svg" class="song-love" alt="Fav">
                                <div>{{ song.likes }}</div>
                            </div>
                            <div style="text-align: center;">
                                <img src="/static/icons/site/comment-icon-light.svg" class="song-comment" alt="Comments">
                                <div>{{ song.lista_resenas | length }}</div>
                            </div>
                            <div style="text-align: center;">
                                <img src="/static/icons/site/views-icon-light.svg" class="song-view" alt="Views">
                                <div>{{ song.visitas }}</div>
                            </div>
                            <div style="text-align: center;">
                                <img src="/static/icons/site/visibility-icon-light.svg" class="song-visible" alt="Visible">
                                <div>{{ "Visible" if song.visible else "Oculto" }}</div>
                            </div>
                        </div>

                        <div class="button-array">
                            <button type="button" style="background-color: white;" onclick="window.location.href='/song?id={{ song.id }}'">üîó</button>
                            <button type="button" style="background-color: #ff4646;" onclick="removeSong('{{ song.id }}')">üóëÔ∏è</button>
                            <button type="button" style="background-color: #0077ff;" onclick="window.location.href='/edit-song?id={{ song.id }}'">‚úèÔ∏è</button>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="div-pannel-sub songs-cell">
                        <button class="add-btn" onclick="window.location.href='/upload-song'">‚ûï A√±adir canci√≥n</button>
                    </div>
                </div>
                <br>
            </div>

            <br>
    </main>

    <script>
        function removeAlbum(id) {
            if (confirm("¬øEst√°s seguro de que deseas eliminar este √°lbum?\nTodas las canciones asociadas a este √°lbum pasar√°n a ser Singles.\n\nEsta acci√≥n no se puede deshacer.")) {
                fetch('/delete-album', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: id })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMessage("√Ålbum eliminado correctamente.", "success");
                        window.location.href = '/studio';
                    } else {
                        displayMessage("Error al eliminar el √°lbum: " + data.error, "error");
                    }
                })
                .catch(error => {
                    displayMessage("Error al procesar la solicitud: " + error.message, "error");
                });
            }
        }

        function removeSong(id) {
            if (confirm("¬øEst√°s seguro de que deseas eliminar esta canci√≥n?\nAl eliminar la canci√≥n se borrar√° del album asociado.\n\nEsta acci√≥n no se puede deshacer.")) {
                fetch('/delete-song', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: id })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMessage("Canci√≥n eliminada correctamente.", "success");
                        window.location.href = '/studio';
                    } else {
                        displayMessage("Error al eliminar la canci√≥n: " + data.error, "error");
                    }
                })
                .catch(error => {
                    displayMessage("Error al procesar la solicitud: " + error.message, "error");
                });
            }
        }
    </script>

    <!-- Pie de p√°gina -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="/static/js/header.js"></script>
    <script src="/static/js/footer.js"></script>
    <script src="/static/js/dark-mode.js"></script>
    <script src="/static/js/displayMessage.js"></script>
</body>

</html>